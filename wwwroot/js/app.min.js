!function(){"use strict";var e={isLoading:!0,visibleCards:{},selectedCities:[],spinner:document.querySelector(".loader"),cardTemplate:document.querySelector(".cardTemplate"),container:document.querySelector(".main"),addDialog:document.querySelector(".dialog-container")};document.getElementById("butRefresh").addEventListener("click",function(){e.updateForecasts()}),document.getElementById("butAdd").addEventListener("click",function(){e.toggleAddDialog(!0)}),document.getElementById("butAddCity").addEventListener("click",function(){var t=document.getElementById("selectCityToAdd").value;e.selectedCities||(e.selectedCities=[]),e.getForecast(t),e.selectedCities.push({icao:t}),e.saveSelectedCities(),e.toggleAddDialog(!1)}),document.getElementById("butAddCancel").addEventListener("click",function(){e.toggleAddDialog(!1)}),e.toggleAddDialog=function(t){t?e.addDialog.classList.add("dialog-container--visible"):e.addDialog.classList.remove("dialog-container--visible")},e.updateForecastCard=function(t){var a=new Date(t.created),i=e.visibleCards[t.loc];i||((i=e.cardTemplate.cloneNode(!0)).classList.remove("cardTemplate"),i.querySelector(".location").textContent=t.loc,i.removeAttribute("hidden"),e.container.appendChild(i),e.visibleCards[t.loc]=i);var r=i.querySelector(".card-last-updated"),n=r.textContent;n&&(n=new Date(n),a.getTime()<n.getTime())||(r.textContent=t.created,i.querySelector(".metar").textContent=t.metar,i.querySelector(".taf").textContent=t.taf,i.querySelector(".linkCharts").textContent="Charts",i.querySelector(".linkCharts").setAttribute("href","/Home/Charts?icao="+t.loc),e.isLoading&&(e.spinner.setAttribute("hidden",!0),e.container.removeAttribute("hidden"),e.isLoading=!1))},e.getForecast=function(a){var i="/Weather/"+a;"caches"in window&&caches.match(i).then(function(t){t&&t.json().then(function(t){var a=t.met[0];a.loc=t.met[0].loc,a.metar=t.met[0].metar,a.taf=t.met[0].taf;var i=t.met[0].metar.toString(),r=i.substring(0,4),n=i.substring(4,6),s=i.substring(6,8),c=i.substring(8,10),o=new Date(r+"-"+n+"-"+s+" "+c+":00");a.created=o.toISOString(),e.updateForecastCard(a)})});var r=new XMLHttpRequest;r.onreadystatechange=function(){if(r.readyState===XMLHttpRequest.DONE){if(200===r.status){var i=JSON.parse(r.response),n=i.met[0];n.loc=a,n.metar=i.met[0].metar,n.taf=i.met[0].taf;var s=i.met[0].metar.toString(),c=s.substring(0,4),o=s.substring(4,6),d=s.substring(6,8),l=s.substring(8,10),u=new Date(c+"-"+o+"-"+d+" "+l+":00");n.created=u.toISOString(),e.updateForecastCard(n)}}else e.updateForecastCard(t)},r.open("GET",i),r.send()},e.updateForecasts=function(){Object.keys(e.visibleCards).forEach(function(t){e.getForecast(t)})},e.saveSelectedCities=function(){var t=JSON.stringify(e.selectedCities);localStorage.selectedCities=t};var t={loc:"SBMT",metar:"METAR",taf:"TAF",created:"2016-07-22T01:00:00Z"};e.selectedCities=localStorage.selectedCities,e.selectedCities?(e.selectedCities=JSON.parse(e.selectedCities),e.selectedCities.forEach(function(t){e.getForecast(t.icao)})):(e.updateForecastCard(t),e.selectedCities=[{icao:t.loc}],e.saveSelectedCities()),"serviceWorker"in navigator&&navigator.serviceWorker.register("./service-worker.js").then(function(){console.log("Service Worker Registered")})}();