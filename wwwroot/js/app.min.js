!function(){"use strict";var e={isLoading:!0,visibleCards:{},selectedCities:[],spinner:document.querySelector(".loader"),cardTemplate:document.querySelector(".cardTemplate"),container:document.querySelector(".main"),addDialog:document.querySelector(".dialog-container")};document.getElementById("butRefresh").addEventListener("click",function(){e.updateForecasts()}),document.getElementById("butAdd").addEventListener("click",function(){e.toggleAddDialog(!0)}),document.getElementById("butAddCity").addEventListener("click",function(){var t=document.getElementById("selectCityToAdd").value;e.selectedCities||(e.selectedCities=[]),e.getWeather(t),e.selectedCities.push({icao:t}),e.saveSelectedCities(),e.toggleAddDialog(!1)}),document.getElementById("butAddCancel").addEventListener("click",function(){e.toggleAddDialog(!1)}),e.toggleAddDialog=function(t){t?e.addDialog.classList.add("dialog-container--visible"):e.addDialog.classList.remove("dialog-container--visible")},e.updateForecastCard=function(t){var i=e.visibleCards[t.loc];i||((i=e.cardTemplate.cloneNode(!0)).classList.remove("cardTemplate"),i.querySelector(".icao").textContent=t.loc,i.removeAttribute("hidden"),e.container.appendChild(i),e.visibleCards[t.loc]=i);var a=i.querySelector(".card-last-updated"),c=a.textContent;c&&(c=new Date(c),dataLastUpdated.getTime()<c.getTime())||(a.textContent=t.created,i.querySelector(".icao").textContent=t.loc,i.querySelector(".metar").textContent=t.metar,i.querySelector(".taf").textContent=t.taf,e.isLoading&&(e.spinner.setAttribute("hidden",!0),e.container.removeAttribute("hidden"),e.isLoading=!1))},e.getWeather=function(i){var a="/Weather/"+i;"caches"in window&&caches.match(a).then(function(t){t&&t.json().then(function(t){var a=t.met[0];a.loc=i,e.updateForecastCard(a)})});var c=new XMLHttpRequest;c.onreadystatechange=function(){if(c.readyState===XMLHttpRequest.DONE){if(200===c.status){var a=JSON.parse(c.response).met[0];a.icao=i,e.updateForecastCard(a)}}else e.updateForecastCard(t)},c.open("GET",a),c.send()},e.updateForecasts=function(){Object.keys(e.visibleCards).forEach(function(t){e.getWeather(t)})},e.saveSelectedCities=function(){var t=JSON.stringify(e.selectedCities);localStorage.selectedCities=t};var t={loc:"SBMT",metar:"METAR",taf:"TAF"};e.selectedCities=localStorage.selectedCities,e.selectedCities?(e.selectedCities=JSON.parse(e.selectedCities),e.selectedCities.forEach(function(t){e.getWeather(t.icao)})):(e.updateForecastCard(t),e.selectedCities=[{icao:t.loc}],e.saveSelectedCities()),"serviceWorker"in navigator&&navigator.serviceWorker.register("./service-worker.js").then(function(){console.log("Service Worker Registered")})}();